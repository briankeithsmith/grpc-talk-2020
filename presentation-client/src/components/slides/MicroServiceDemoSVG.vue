<template>
  <section>
    <svg
      id="micro-service-demo-svg"
      viewBox="0 0 825 900"
      height="700px"
      width="475px"
      
      xmlns="http://www.w3.org/2000/svg"
      xmlns:bx="https://boxy-svg.com"
    >
      <g transform="matrix(1, 0, 0, 1, 73.396477, 657.781067)">
        <rect class="service-box" x="123.328" y="92.222" width="100" height="100" rx="25" ry="25" />
        <text class="service-name" x="134.444" y="152.778">Users</text>
      </g>
      <g transform="matrix(1, 0, 0, 1, -79.037346, 91.395866)">
        <rect class="service-box" x="209.444" y="325" width="179.431" height="100" rx="25" ry="25" />
        <text class="service-name" x="226.683" y="384.445">Comments</text>
      </g>
      <g transform="matrix(1, 0, 0, 1, 258.39151, 550.717224)">
        <rect class="service-box" x="300" y="47.222" width="200" height="100" rx="25" ry="25" />
        <text class="service-name" x="317.223" y="105.555">Reservations</text>
      </g>
      <g transform="matrix(1, 0, 0, 1, 180.05748, 406.172333)">
        <rect
          class="service-box"
          x="16.667"
          y="182.779"
          width="237.778"
          height="100"
          rx="25"
          ry="25"
        />
        <text class="service-name" x="26.667" y="242.778">Recomendations</text>
      </g>
      <g transform="matrix(1, 0, 0, 1, 65.058495, 131.001465)">
        <rect class="service-box" x="369.444" y="225" width="123.889" height="100" rx="25" ry="25" />
        <text class="service-name" y="283.903" x="388.889">Search</text>
      </g>
      <g transform="matrix(1, 0, 0, 1, -83.276726, -91.029388)">
        <rect class="service-box" x="209.444" y="325" width="222.57" height="100" rx="25" ry="25" />
        <text class="service-name" x="226.683" y="384.445">Authentication</text>
      </g>
      <g transform="matrix(1, 0, 0, 1, 464.147552, 131.001465)">
        <rect class="service-box" x="209.444" y="325" width="99.302" height="100" rx="25" ry="25" />
        <text class="service-name" x="226.683" y="384.445">Adds</text>
      </g>
      <path
        d="M 460.263 228.117 H 573.757 L 566.757 216.617 L 585.757 230.617 L 566.757 244.617 L 573.757 233.117 H 460.263 V 228.117 Z"
        style="fill: rgb(88, 88, 88);"
        transform="matrix(0.917973, 0.396642, -0.396642, 0.917973, 227.354904, 52.753277)"
        bx:shape="arrow 460.263 216.617 125.494 28 5 19 7 1@ecdff4f2"
      />
      <g transform="matrix(1.34789, 0, 0, 1, 217.692642, -308.604126)">
        <rect
          class="service-box-blue"
          style
          x="209.444"
          y="325"
          width="222.57"
          height="100"
          rx="25"
          ry="25"
        />
        <text class="service-name" x="290" y="385">User</text>
      </g>
      <path
        d="M 391.138 237.106 H 552.547 L 545.547 225.606 L 564.547 239.606 L 545.547 253.606 L 552.547 242.106 H 391.138 V 237.106 Z"
        class="arrow"
        :class="{'warn': subSlide === 21}"
        transform="matrix(-0.642027, 0.766682, -0.766682, -0.642027, 924.089355, 309.95639)"
        bx:shape="arrow 391.138 225.606 173.409 28 5 19 7 1@d57b6868"
      />
      <path
        d="M 254.5 420.731 H 369.24 L 363.944 409.231 L 378.319 423.231 L 363.944 437.231 L 369.24 425.731 H 254.5 V 420.731 Z"
        class="arrow"
        :class="{'warn': subSlide === 21}"
        transform="matrix(0.999846, -0.017573, 0.017573, 0.999846, 172.604385, 220.933701)"
        bx:shape="arrow 254.5 409.231 123.819 28 5 14.375 5.296 1@0b2192ea"
      />
      <path
        d="M 200 470.055 H 261.003 L 254.003 458.555 L 273.003 472.555 L 254.003 486.555 L 261.003 475.055 H 200 V 470.055 Z"
        class="arrow"
        :class="{'warn': subSlide === 21}"
        transform="matrix(-0.548279, 0.836295, -0.836295, -0.548279, 802.980713, 780.78479)"
        bx:shape="arrow 200 458.555 73.003 28 5 19 7 1@4d200154"
      />
      <path
        d="M 560.686 -102.5 H 822.387 L 815.387 -114 L 834.387 -100 L 815.387 -86 L 822.387 -97.5 H 560.686 V -102.5 Z"
        class="arrow"
        transform="matrix(-0.483347, 0.875429, -0.875429, -0.483347, 842.278442, -422.779785)"
        bx:shape="arrow 560.686 -114 273.701 28 5 19 7 1@9fe2145a"
      />
      <path
        d="M 341.78 137.106 H 429.182 L 422.182 125.606 L 441.182 139.606 L 422.182 153.606 L 429.182 142.106 H 341.78 V 137.106 Z"
        transform="matrix(-0.917195, -0.398438, 0.398438, -0.917195, 697.762939, 620.224976)"
        class="arrow"
        bx:shape="arrow 341.78 125.606 99.402 28 5 19 7 1@b18c7264"
      />
      <path
        d="M 245.03 115.075 H 334.594 L 327.594 103.575 L 346.594 117.575 L 327.594 131.575 L 334.594 120.075 H 245.03 V 115.075 Z"
        transform="matrix(0.896946, 0.44214, -0.44214, 0.896946, 175.364685, 120.174759)"
        class="arrow"
        bx:shape="arrow 245.03 103.575 101.564 28 5 19 7 1@77f6ecea"
      />
      <path
        d="M 336.374 186.832 H 455.697 L 448.697 175.332 L 467.697 189.332 L 448.697 203.332 L 455.697 191.832 H 336.374 V 186.832 Z"
        transform="matrix(-0.949298, 0.314378, -0.314378, -0.949298, 813.343079, 479.711853)"
        class="arrow"
        bx:shape="arrow 336.374 175.332 131.323 28 5 19 7 1@76bd9a3a"
      />
      <path
        d="M 211.709 257.779 H 331.424 L 324.424 246.279 L 343.424 260.279 L 324.424 274.279 L 331.424 262.779 H 211.709 V 257.779 Z"
        transform="matrix(0.946477, -0.322771, 0.322771, 0.946477, 25.449558, 298.660156)"
        class="arrow"
        bx:shape="arrow 211.709 246.279 131.715 28 5 19 7 1@f40e4fc1"
      />
      <path
        d="M 308.714 370.055 H 467.64 L 460.64 358.555 L 479.64 372.555 L 460.64 386.555 L 467.64 375.055 H 308.714 V 370.055 Z"
        transform="matrix(0.628483, -0.777823, 0.777823, 0.628483, -76.96093, 594.931458)"
        class="arrow"
        :class="{'warn': subSlide === 21}"
        bx:shape="arrow 308.714 358.555 170.926 28 5 19 7 1@d3855adb"
      />
      <path
        d="M 576.836 253.66 H 687.789 L 680.789 242.16 L 699.789 256.16 L 680.789 270.16 L 687.789 258.66 H 576.836 V 253.66 Z"
        transform="matrix(-0.907504, -0.420043, 0.420043, -0.907504, 1090.848511, 947.318298)"
        class="arrow"
        bx:shape="arrow 576.836 242.16 122.953 28 5 19 7 1@bdec185f"
      />

      <path
        d="M 552.839 360.268 H 810.311 L 803.311 348.768 L 822.311 362.768 L 803.311 376.768 L 810.311 365.268 H 552.839 V 360.268 Z"
        class="arrow"
        transform="matrix(0.453208, -0.891405, 0.891405, 0.453208, -21.085651, 691.162048)"
        bx:shape="arrow 552.839 348.768 269.472 28 5 19 7 1@d1c9f94b"
      />

      <path
        d="M 188.79 538.784 H 255.542 L 248.542 527.284 L 267.542 541.284 L 248.542 555.284 L 255.542 543.784 H 188.79 V 538.784 Z"
        transform="matrix(0.488227, -0.872717, 0.872717, 0.488227, -277.641022, 658.170654)"
        class="arrow"
        :class="{'warn': subSlide === 21}"
        bx:shape="arrow 188.79 527.284 78.752 28 5 19 7 1@86a15baf"
      />
      <path
        d="M -557.505 -656.125 H -446.257 L -453.257 -667.625 L -434.257 -653.625 L -453.257 -639.625 L -446.257 -651.125 H -557.505 V -656.125 Z"
        transform="matrix(-1, 0, 0, -1, 0, 0)"
        class="arrow"
        :class="{'warn': subSlide === 21}"
        bx:shape="arrow -557.505 -667.625 123.248 28 5 19 7 1@ff20efbe"
      />

      <text class="big" y="326.595" x="385.377" v-if="subSlide === 1">1</text>
      <text class="big" y="507.059" x="416.579" v-if="subSlide === 2">2</text>
      <text class="big" x="614.997" y="430.876" v-if="subSlide === 2">2</text>
      <text class="big" y="625.915" x="487.283" v-if="subSlide === 3">3</text>
      <text class="big" y="725.355" x="235.990" v-if="subSlide === 3">3</text>
      <!-- <text class="big" y="417.695" x="350.108" v-if="subSlide === 4">4</text> -->
      <text class="big" y="507.059" x="416.579" v-if="subSlide === 4">4</text>
      <text class="big" y="417.695" x="350.108" v-if="subSlide === 5">5</text>
      <text class="big" y="212.678" x="574.512" v-if="subSlide === 6">6</text>

      <text y="212.678" x="545.512" v-if="subSlide >= 7 && subSlide <= 21">1.5 (s)</text>
      <text y="326.595" x="385.377" v-if="subSlide === 8">1.5 (s)</text>
      <text y="377.936" x="352.889" v-if="subSlide === 9">.1 (s)</text>
      <text y="430.863" x="605.974" v-if="subSlide >= 10 && subSlide <= 19">1.4 (s)</text>
      <text y="492.342" x="562.996" v-if="subSlide === 20">1.1 (s)</text>
      <text y="519.691" x="375.818" v-if="subSlide >= 10 && subSlide <= 14">1.4 (s)</text>
      <text y="622.585" x="475.898" v-if="subSlide === 12">1.2 (s)</text>
      <text y="723.659" x="200.768" v-if="subSlide >= 12 && subSlide <= 13">1.2 (s)</text>
      <text y="676.408" x="478.684" v-if="subSlide === 13">.3 (s)</text>
      <text y="735.474" x="322.662" v-if="subSlide === 14">.4 (s)</text>
      <text y="530.634" x="475.910" v-if="subSlide === 15">.6 (s)</text>
      <text y="410.695" x="350.108" v-if="subSlide === 16">.6 (s)</text>
      <text y="479.551" x="354.826" v-if="subSlide === 17">.3 (s)</text>
      <text y="519.681" x="386.696" v-if="subSlide >= 18 && subSlide <= 20">.5 (s)</text>
      <text y="723.659" x="200.768" v-if="subSlide >= 19 && subSlide <= 20">.5 (s)</text>
      <text y="622.585" x="475.898" v-if="subSlide >= 19 && subSlide <= 20">.5 (s)</text>
      <text y="212.678" x="650.512" v-if="subSlide === 22">1.2 (s)</text>

      <g transform="matrix(1, 0, 0, 1, -323.409637, 319.661499)">
        <text x="395.8" y="-154.83" class="summary">Elapsed Time :</text>
        <text class="summary" x="450" y="-237">Deadline :</text>
        <text x="600" y="-237" class="summary">1.5 (s)</text>
        <text
          x="600"
          y="-154"
          class="summary"
          :class="{'success': subSlide === 22}"
        >{{ elapsedTime }}</text>
        <text
          x="600"
          y="-196"
          class="summary"
          :class="{'success': subSlide === 22}"
        >{{ timeRemaining }}</text>
        <text x="358" y="-196" class="summary">Remaining Time :</text>
      </g>
    </svg>
  </section>
</template>
<script lang="ts">
import { Component, Prop, Vue } from "vue-property-decorator";

const duration = [
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0.1,
  0,
  0,
  0.2,
  0.3,
  0.1,
  0,
  0,
  0.3,
  0,
  0,
  0.1,
  0.1
];

const timeTaken: number[] = [0];
for (let i = 1; i < duration.length; i++) {
  timeTaken.push(timeTaken[i - 1] + duration[i]);
}

const totalDuration = 1.5;

@Component
export default class MicroServiceDemoSVGComponent extends Vue {
  @Prop({ required: false, type: Number, default: 0 }) public subSlide!: number;

  public get elapsedTime(): string {
    if (this.subSlide < 0) {
      return timeTaken[0].toFixed(1) + " (s)";
    }
    if (this.subSlide >= timeTaken.length) {
      return timeTaken[timeTaken.length - 1].toFixed(1) + " (s)";
    }

    return timeTaken[this.subSlide].toFixed(1) + " (s)";
  }

  public get timeRemaining(): string {
    if (this.subSlide < 0) {
      return (totalDuration - timeTaken[0]).toFixed(1) + " (s)";
    }
    if (this.subSlide >= timeTaken.length) {
      return (
        (totalDuration - timeTaken[timeTaken.length - 1]).toFixed(1) + " (s)"
      );
    }

    return (totalDuration - timeTaken[this.subSlide]).toFixed(1) + " (s)";
  }
}
</script>

<style lang="scss" scoped>
#micro-service-demo-svg text {
  white-space: pre;
  fill: rgb(51, 51, 51);
  font-size: 19px;
}

#micro-service-demo-svg text.big {
  font-size: 45px;
}

#micro-service-demo-svg text.summary {
  font-size: 28px;
}

#micro-service-demo-svg text.service-name {
  font-size: 29px;
  fill: white;
}

.service-box {
  fill: rgb(165, 239, 101);
  stroke: rgb(0, 0, 0);
  stroke-width: 2px;
}

.service-box-blue {
  @extend .service-box;
  fill: rgb(101, 168, 239);
}

.warn {
  fill: rgb(239, 179, 101) !important;
}

.success {
  fill: rgb(80, 206, 42) !important;
}

.arrow {
  fill: rgb(88, 88, 88);
}
</style>